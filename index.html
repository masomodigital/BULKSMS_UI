<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>User Login</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f4f4f4;
      display: flex;
      justify-content: center;
      padding-top: 40px;
    }
    .container {
      background-color: white;
      padding: 30px 40px;
      border-radius: 10px;
      box-shadow: 0 0 12px rgba(0,0,0,0.1);
      max-width: 400px;
      width: 100%;
    }
    h2, h3, h4 { text-align: center; }
    label {
      font-weight: bold;
      display: block;
      margin-top: 12px;
    }
    input {
      width: 100%;
      padding: 10px;
      margin-top: 6px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    button {
      background-color: #28a745;
      color: white;
      padding: 10px;
      margin-top: 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      width: 100%;
    }
    button:hover { background-color: #218838; }
    .hidden { display: none; }
    .contact-row {
      margin-bottom: 10px;
      padding: 8px;
      background-color: #f9f9f9;
      border-radius: 5px;
    }
    .contact-row button {
      background-color: red;
      float: right;
      padding: 5px 10px;
      font-size: 12px;
    }
    #addResult, #loginError {
      margin-top: 10px;
      text-align: center;
    }
    #addResult { color: green; }
    #loginError { color: red; }
    #contactsList {
      max-height: 300px;
      overflow-y: auto;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 5px;
    }
    .show-password-container { margin-top: 5px; }
  </style>
</head>
<body>
  <div class="container">
    <h2 style="color: green; font-weight: bold;">USER LOGIN</h2>
    <div id="loginDiv">
      <label>National ID:</label>
      <input type="text" id="nationalID" />
      <label>Password:</label>
      <input type="password" id="userPassword" />
      <button onclick="login()">Login</button>
      <p id="loginError"></p>
    </div>

    <div id="dashboard" class="hidden">
      <h3>Welcome, <span id="userName" style="color: red;"></span></h3>
      <p><strong>National ID:</strong> <span id="userID"></span></p>
      <p><strong>Credits:</strong> <span id="userCredits"></span></p>
      <p><strong>Password:</strong>
        <input type="password" id="userPasswordDisplay" readonly />
        <div class="show-password-container">
          <input type="checkbox" id="showPasswordCheckbox" onclick="togglePasswordVisibility()" />
          <label for="showPasswordCheckbox">Show Password</label>
        </div>
      </p>
      <p><strong>Phone Number:</strong> <span id="userPhone"></span></p>
      <p><strong>Number of Contacts:</strong> <span id="contactCount"></span></p>

      <h4>Your Contacts</h4>
      <div id="contactsList"></div>

      <h4>Add New Contact</h4>
      <input type="text" id="newContactName" placeholder="Name" />
      <input type="text" id="newContactPhone" placeholder="Phone Number" />
      <button onclick="addNewContact()">Add Contact</button>
      <p id="addResult"></p>
    </div>
  </div>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycby_fnlkXtBnHo33ZRBFX6Dqja_GlEqA0W2jefoOM8ctwM9thu62oYeTjkpYrkJHUw5x/exec";
    let currentID = "";

    function login() {
      const nationalID = document.getElementById("nationalID").value.trim();
      const password = document.getElementById("userPassword").value.trim();
      if (!nationalID || !password) return;

      fetch(SCRIPT_URL, {
        method: "POST",
        body: JSON.stringify({ action: "login", nationalID, password })
      })
      .then(res => res.json())
      .then(data => {
        if (data.error) {
          document.getElementById("loginError").innerText = data.error;
          return;
        }

        document.getElementById("loginDiv").classList.add("hidden");
        document.getElementById("dashboard").classList.remove("hidden");

        currentID = data.nationalID;
        document.getElementById("userName").innerText = data.name;
        document.getElementById("userID").innerText = data.nationalID;
        document.getElementById("userCredits").innerText = data.credits;
        document.getElementById("userPasswordDisplay").value = data.password;
        document.getElementById("userPhone").innerText = data.phone;
        updateContactList(data.contacts);
      });
    }

    function updateContactList(contacts) {
      const listDiv = document.getElementById("contactsList");
      listDiv.innerHTML = "";

      contacts.forEach(contact => {
        const div = document.createElement("div");
        div.className = "contact-row";
        div.innerHTML = `${contact.name} - ${contact.phone} <button onclick="deleteContact('${contact.phone}')">Delete</button>`;
        listDiv.appendChild(div);
      });

      document.getElementById("contactCount").innerText = contacts.length;
    }

    function addNewContact() {
      const name = document.getElementById("newContactName").value.trim();
      const phone = document.getElementById("newContactPhone").value.trim();
      if (!name || !phone) return;

      fetch(SCRIPT_URL, {
        method: "POST",
        body: JSON.stringify({ action: "addContact", nationalID: currentID, name, phone })
      })
      .then(res => res.json())
      .then(data => {
        document.getElementById("addResult").innerText = data.success || data.error;
        document.getElementById("newContactName").value = "";
        document.getElementById("newContactPhone").value = "";
        login(); // Refresh
      });
    }

    function deleteContact(phone) {
      if (!confirm("Are you sure you want to delete this contact?")) return;

      fetch(SCRIPT_URL, {
        method: "POST",
        body: JSON.stringify({ action: "deleteContact", nationalID: currentID, phone })
      })
      .then(res => res.json())
      .then(data => {
        alert(data.success || data.error);
        login(); // Refresh
      });
    }

    function togglePasswordVisibility() {
      const pwdField = document.getElementById("userPasswordDisplay");
      pwdField.type = pwdField.type === "password" ? "text" : "password";
    }
  </script>
</body>
</html>
